#!/bin/python

import sys
import argparse
import tempfile
import subprocess
from PIL import Image, UnidentifiedImageError

def display_image(image):
	width, height = image.size
	new_width, new_height = width, height + 22
	new_image = Image.new('RGBA', (new_width, new_height), (0, 0, 0, 0))
	new_image.paste(image)
	with tempfile.NamedTemporaryFile(suffix=".png") as temp_file:
		new_image.save(temp_file)
		subprocess.run(("img2sixel", temp_file.name))

parser = argparse.ArgumentParser(
	prog="view-image",
	description="View image using img2sixel, adding additional transparent pixels at bottom of image to work around foot bug."
)
parser.add_argument(
	"image_path",
	help="Path to image"
)
arguments = parser.parse_args()
image_path = arguments.image_path

try:
	with Image.open(image_path) as image:
		display_image(image)
except UnidentifiedImageError:
	print(f"invalid image: {image_path}", file=sys.stderr)
	exit(1)
