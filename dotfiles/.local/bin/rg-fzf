#!/bin/sh

decode_field2="base32 --decode <<< {2}"
fzf --disabled \
    --read0 \
    --delimiter ":" \
    --wrap \
    --ansi \
    --color pointer:3 \
    --tabstop 4 \
    --with-nth "7.." \
    --query "rg.smart_case();;" \
    --preview "if [ {1} = 'match' ]; then $decode_field2 | xargs -0 realpath --relative-to=. --zero | xargs -0 printf 'file: %q\n'; $decode_field2 | xargs -0 bat --color=always --style=numbers --highlight-line={4}:{6}; else $decode_field2; fi" \
    --preview-window "top,~1,+{5}+1/2" \
    --bind "start:reload::" \
    --bind "enter:reload:rg-fzf-rg-wrapper.py {q}" \
    --bind "resize:refresh-preview" \
    --bind "ctrl-space:execute([ {1} = 'match' ] && $decode_field2 | xargs -0 nvim -c 'goto '{3}'|normal zz')" \
    --bind "ctrl-l:execute-silent([ {1} = 'match' ] && $decode_field2 | kitty +kitten clipboard)" \
    --bind "ctrl-q:execute-silent([ {1} = 'match' ] && $decode_field2 | xargs -0 printf '%q' | kitty +kitten clipboard)" \
    --bind "home:first" \
    --bind "end:last" > /dev/null
