#!/bin/sh

decode_file="base32 --decode <<< {1}"
rg_args=${*@Q}
FZF_DEFAULT_COMMAND=":" fzf \
    --read0 \
    --delimiter ":" \
    --with-nth "6.." \
    --ansi \
    --disabled \
    --preview "$decode_file | xargs -0 cat-highlight-byte-region.py {2} {4}" \
    --preview-window "+{5}/2" \
    --bind "resize:refresh-preview" \
    --bind "change:reload:rg-fzf-rg-wrapper.py {q} $rg_args || true" \
    --bind "ctrl-space:execute($decode_file | xargs -0 nvim -c 'goto '{3}'|normal zz' -f)" \
    --bind "enter:execute-silent($decode_file | xargs -0 printf '%q' | kitty +kitten clipboard)" > /dev/null
